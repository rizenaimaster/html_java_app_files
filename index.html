<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RizenAi Content Repurposer - Mason Mk1 (v7)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles based on RizenAi requirements */
        :root {
            --bg-dark: #00243B; /* Dark midnight blue */
            --accent-cyan: #00FFFF; /* Neon Cyan */
            --accent-aqua: #00BFFF; /* Aqua */
            --accent-magenta: #FF00FF; /* Bright Magenta for new gradient */
            --accent-gold: #FFD700; /* Gold/Yellow for new gradient */
        }
        
        body {
            background-color: var(--bg-dark);
            font-family: 'Poppins', sans-serif;
        }

        /* Neon Border Gradient (0.5mm border) - New Multi-Color */
        .neon-border {
            border: 2px solid transparent;
            background-clip: padding-box, border-box;
            background-origin: padding-box, border-box;
            background-image: linear-gradient(to bottom, var(--bg-dark), var(--bg-dark)), 
                              linear-gradient(to right, var(--accent-cyan), var(--accent-magenta), var(--accent-gold), var(--accent-cyan));
            border-radius: 0.5rem; /* Rounded corners */
        }

        /* Embossed/3D Button Style */
        .neon-button {
            background: linear-gradient(145deg, var(--accent-aqua), var(--accent-cyan));
            color: var(--bg-dark);
            font-weight: 600;
            transition: all 0.2s ease;
            border-radius: 0.5rem;
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.4), 
                0 0 15px var(--accent-cyan); 
        }

        .neon-button:hover {
            background: linear-gradient(145deg, var(--accent-cyan), var(--accent-aqua));
            transform: translateY(-1px);
            box-shadow: 
                0 6px 8px rgba(0, 0, 0, 0.6),
                0 0 20px var(--accent-aqua); 
        }

        /* Input fields */
        .neon-input {
            background-color: rgba(0, 0, 0, 0.3); 
            border: 1px solid var(--accent-cyan); 
            color: white;
            transition: border-color 0.2s;
        }
        .neon-input:focus {
            border-color: var(--accent-aqua);
            box-shadow: 0 0 8px rgba(0, 191, 255, 0.5);
            outline: none;
        }

        /* Status Text Styling */
        #status-message {
            min-height: 2rem; /* Ensure minimum space to prevent layout shifts */
            color: var(--accent-cyan);
            font-weight: 500;
            font-size: 1.1rem;
        }

        /* Style for the target platform options: forcing each option onto its own line */
        .platform-options label {
            width: 100%; /* Full width forces single column layout */
            margin-bottom: 0.75rem; /* Add spacing between options */
        }
        .platform-options {
            /* Remove default gap that might interfere with vertical layout */
            gap: 0 !important; 
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex flex-col items-center">

    <!-- Header -->
    <header class="text-center mb-8 w-full max-w-4xl">
        <!-- Main Headline: Updated to RizenAi Content Repurposer -->
        <h1 class="text-4xl md:text-5xl font-bold mb-2 text-white">
            RizenAi Content Repurposer
        </h1>
        <!-- Sub-Headline: Two lines, quotes removed from the first line -->
        <p class="text-xl text-gray-300">
            Turn one piece of older content into many
        </p>
        <p class="text-lg italic text-cyan-400">
            ‚ÄúGood stories never die; They are just retold time and over again‚Äù
        </p>
    </header>

    <!-- Main Container -->
    <main class="w-full max-w-4xl">
        
        <!-- Input Form Section -->
        <div id="input-section" class="neon-border p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-semibold text-white mb-6 border-b border-cyan-500 pb-2">Your Blueprint (The Man-Machine Teaming Input)</h2>
            <form id="repurpose-form" class="space-y-6">

                <!-- Profile Details -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="user-name" class="block text-sm font-medium text-cyan-300 mb-1">My Name</label>
                        <input type="text" id="user-name" required class="neon-input w-full p-3 rounded-lg" placeholder="Mandatory: e.g., Sudip">
                    </div>
                    <div>
                        <label for="profession" class="block text-sm font-medium text-cyan-300 mb-1">My Profession (20 words max)</label>
                        <input type="text" id="profession" required class="neon-input w-full p-3 rounded-lg" placeholder="Mandatory: e.g., Solopreneur Coach focused on time-freedom systems.">
                    </div>
                </div>

                <!-- Goals and Tone - Labels updated with e.g., -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="objective" class="block text-sm font-medium text-cyan-300 mb-1">Objective for Repurposing (e.g., Reach More People)</label>
                        <select id="objective" required class="neon-input w-full p-3 rounded-lg appearance-none">
                            <option value="reach more people">Reach More People (Audience Growth)</option>
                            <option value="boost engagement">Boost Engagement (Interaction)</option>
                            <option value="promote service">Promote a Specific Service/Product</option>
                            <option value="build authority">Build Authority/Thought Leadership</option>
                        </select>
                    </div>
                    <div>
                        <label for="tone" class="block text-sm font-medium text-cyan-300 mb-1">Desired Tone & Style (e.g., Casual and Friendly)</label>
                        <select id="tone" required class="neon-input w-full p-3 rounded-lg appearance-none">
                            <option value="informative">Informative and Professional</option>
                            <option value="casual">Casual and Friendly (Storytelling)</option>
                            <option value="bold">Bold and Provocative</option>
                            <option value="motivational">Motivational and Encouraging</option>
                        </select>
                    </div>
                </div>

                <!-- Target Platforms - Layout Fixed for Mobile/Desktop to ensure one per row -->
                <div>
                    <label class="block text-sm font-medium text-cyan-300 mb-2">Target Platforms (Select multiple)</label>
                    <!-- IMPORTANT: Using flex-col and removing gap to force vertical stacking -->
                    <div class="platform-options flex flex-col gap-3 text-white"> 
                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="platform" value="LinkedIn Post" class="form-checkbox h-5 w-5 text-cyan-500 rounded-lg"> <span class="ml-2">LinkedIn Post (Professional)</span></label>
                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="platform" value="Twitter/X Thread" class="form-checkbox h-5 w-5 text-cyan-500 rounded-lg"> <span class="ml-2">Twitter/X Thread (Short, punchy)</span></label>
                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="platform" value="Instagram Carousel Script" class="form-checkbox h-5 w-5 text-cyan-500 rounded-lg"> <span class="ml-2">Instagram Carousel/Reel Script (Visual Focus)</span></label>
                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="platform" value="Blog Intro Paragraph" class="form-checkbox h-5 w-5 text-cyan-500 rounded-lg"> <span class="ml-2">Blog Intro Paragraph (SEO/Long-form Hook)</span></label>
                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="platform" value="Email Newsletter Snippet" class="form-checkbox h-5 w-5 text-cyan-500 rounded-lg"> <span class="ml-2">Email Newsletter Snippet (Direct-to-Subscriber)</span></label>
                    </div>
                </div>

                <!-- Original Content - Label updated with word limit -->
                <div>
                    <label for="original-content" class="block text-sm font-medium text-cyan-300 mb-1">Your Original Content (up to 200 words recommended)</label>
                    <textarea id="original-content" rows="6" required class="neon-input w-full p-3 rounded-lg" placeholder="Mandatory: Paste your original article, transcript, or long-form content here. Example: 'When I started, I spent 8 hours on content creation. Now, I use AI systems to reduce that to 1 hour, giving me 7 hours back for client work. Here is how I set up my Time-Freedom System...'"></textarea>
                </div>

                <!-- Extra Info -->
                <div>
                    <label for="extra-info" class="block text-sm font-medium text-cyan-300 mb-1">Any Extra Vital Information (e.g., specific keywords, call to action)</label>
                    <input type="text" id="extra-info" class="neon-input w-full p-3 rounded-lg" placeholder="Optional: e.g., Primary CTA is 'Visit rizenai.co to download my free guide.'">
                </div>

                <div id="status-message" class="text-center"></div>

                <button type="submit" id="generate-button" class="neon-button w-full p-4 text-lg mt-4">
                    <span id="button-text">üöÄ Plug & Play: Repurpose Content Now</span>
                    <span id="loading-icon" class="hidden"></span>
                </button>
            </form>
        </div>

        <!-- Output Section -->
        <div id="output-section" class="hidden neon-border p-6 md:p-8">
            <h2 class="text-2xl font-semibold text-white mb-6 border-b border-aqua-500 pb-2">Your Deliverables (The Profit)</h2>
            <div id="results-container" class="space-y-6 mb-6">
                <!-- Results will be injected here -->
            </div>

            <!-- Download Button -->
            <button id="download-button" class="neon-button text-base px-6 py-3" style="background: linear-gradient(145deg, var(--accent-gold), var(--accent-magenta));">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 11.586V3a1 1 0 112 0v8.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                Download All Content (.txt)
            </button>
        </div>

        <!-- Error/Message Box -->
        <div id="message-box" class="hidden fixed top-0 left-1/2 transform -translate-x-1/2 mt-4 p-4 text-center rounded-lg shadow-lg text-white font-semibold z-50 transition-opacity duration-300" style="background-color: #A52A2A;">
            <!-- Messages will appear here -->
        </div>

    </main>
    
    <!-- Footer for Copyright -->
    <footer class="mt-8 text-center text-gray-500 text-xs">
        <p class="mt-1">¬© RizenAi.Co | All Rights Reserved</p>
    </footer>

    <!-- Firebase and Application Logic -->
    <script type="module">
        // Firebase Imports (Standard canvas requirement, even if minimal)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth;
        let lastGeneratedResults = null; // Store results for the download button

        // Configuration for the Gemini API
        const GEMINI_MODEL = 'gemini-2.5-flash-preview-09-2025';
        const API_KEY = ""; // Canvas provides this securely
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${API_KEY}`;
        
        const statusElement = document.getElementById('status-message');
        const buttonText = document.getElementById('button-text');
        const generateButton = document.getElementById('generate-button');
        const loadingIcon = document.getElementById('loading-icon'); // Placeholder for potential GIF/spinner
        
        // Retrieve CSS variable values once for use in JS
        const style = getComputedStyle(document.body);
        const accentGold = style.getPropertyValue('--accent-gold').trim();
        const accentCyan = style.getPropertyValue('--accent-cyan').trim();

        // Utility for displaying temporary messages
        function showMessage(text, isError = false) {
            const box = document.getElementById('message-box');
            box.textContent = text;
            box.style.backgroundColor = isError ? '#A52A2A' : '#10B981'; // Red for error, Green for success
            box.classList.remove('hidden');
            box.style.opacity = '1';

            setTimeout(() => {
                box.style.opacity = '0';
                setTimeout(() => box.classList.add('hidden'), 300);
            }, 5000);
        }

        // Initialize Firebase and Authentication (standard canvas requirement)
        async function initializeAppAndAuth() {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    // Use setLogLevel('error') to avoid excessive logs unless needed for specific Firestore debugging
                    setLogLevel('error'); 

                    // Check if initialAuthToken is defined before trying to sign in
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                }
            } catch (error) {
                // Log Firebase errors but allow the rest of the application to proceed
                console.error("Firebase Initialization or Auth Failed:", error);
            }
        }

        // --- Core Application Logic: API Call and Prompt Construction ---

        function getFormData() {
            const selectedPlatforms = Array.from(document.querySelectorAll('input[name="platform"]:checked')).map(el => el.value);
            
            if (selectedPlatforms.length === 0) {
                showMessage("Please select at least one target platform.", true);
                return null;
            }

            return {
                name: document.getElementById('user-name').value.trim(),
                profession: document.getElementById('profession').value.trim(),
                objective: document.getElementById('objective').value,
                tone: document.getElementById('tone').value,
                platforms: selectedPlatforms,
                originalContent: document.getElementById('original-content').value.trim(),
                extraInfo: document.getElementById('extra-info').value.trim()
            };
        }

        // --- ENHANCED System Instruction for Quality Mitigation ---
        function createSystemInstruction(data) {
            // This instruction uses Persona-Driven Chaining to simulate the quality of three models 
            // (Gemini's grounding, ChatGPT's context, Claude's human-like output).

            return `
                You are the RizenAi Content Repurposing System Orchestrator. Your goal is to execute a high-quality, 
                human-centric 3-phase workflow in one step to ensure the final output is creative, non-mechanical, and ready for publication.

                **User Profile & Goals:**
                - **Name:** ${data.name}
                - **Profession:** ${data.profession}
                - **Objective:** ${data.objective}
                - **Tone/Style:** ${data.tone}
                - **Target Platforms:** ${data.platforms.join(', ')}
                - **Extra Context:** ${data.extraInfo || 'None provided.'}

                **Execution Phases (Simulating Multi-LLM Quality):**
                
                1. **PHASE 1 (Captain's Order Block - Gemini Role):** Use Google Search grounding to analyze current digital content trends for ${data.profession} and the target platforms. Define the core **Thematic Focus** and the **Emotional Hook** required for maximum impact in a ${data.tone} style.
                
                2. **PHASE 2 (Sous Chef's Blueprint - ChatGPT Role):** Based on the Captain's Focus, adopt the persona of a senior digital strategist with wide context. Draft a precise, optimized production prompt for each target platform, ensuring structure (hooks, CTAs, thread format, visual cues) is tailored to platform best practices (e.g., LinkedIn for authority, Instagram for visual story). This phase is purely contextual preparation.
                
                3. **PHASE 3 (Chef-de-Partie Production - Claude Role):** Adopt the persona of a human, expert copywriter known for highly creative, authentic, and emotionally resonant content. Write the final repurposed content for each platform. **CRITICAL:** The output MUST avoid repetition, generic AI language, and overly mechanical phrasing. It must sound like an expert human in the ${data.tone} style wrote it. The core message from the Original Content must be preserved, not summarized.

                **Original Content to Repurpose:**
                ---
                ${data.originalContent}
                ---

                **Output Format (CRITICAL):**
                You MUST respond only with a single JSON object. The keys must be the platform names (using underscores instead of spaces, e.g., LinkedIn_Post), and the values must be the fully repurposed, human-like content for that platform.

                {
                    "${data.platforms[0].replace(/ /g, '_')}": "The human-like repurposed content for Platform 1...",
                    // ... continue for all selected platforms
                }
                
                Do not include any greeting, commentary, or markdown outside of the JSON structure.
                Ensure the JSON is perfectly valid and ready for parsing.
            `;
        }
        // --- END ENHANCED System Instruction ---

        function updateStatus(message, isWorking = true) {
            statusElement.textContent = message;
            // Using raw JS variable names instead of CSS var() function
            statusElement.style.color = isWorking ? accentGold : accentCyan; 
            generateButton.disabled = isWorking;
            if (isWorking) {
                buttonText.textContent = "Processing...";
                loadingIcon.classList.remove('hidden'); // Show loading icon/placeholder
            } else {
                buttonText.textContent = "üöÄ Plug & Play: Repurpose Content Now";
                loadingIcon.classList.add('hidden'); // Hide loading icon/placeholder
            }
        }


        async function fetchContent(data) {
            const systemInstruction = createSystemInstruction(data);
            const userQuery = `Original Content to be Repurposed: ${data.originalContent}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] },
                // Use Google Search grounding for Phase 1 analysis
                tools: [{ "google_search": {} }], 
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: data.platforms.reduce((acc, platform) => {
                            // Ensure the keys in the schema also match the expected JSON keys (using underscores)
                            acc[platform.replace(/ /g, '_')] = { type: "STRING" };
                            return acc;
                        }, {})
                    }
                }
            };

            const maxRetries = 5;
            let delay = 1000;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    updateStatus("Order Received: Processing request...", true);
                    
                    // Simulate the time it takes to do multi-phase analysis
                    await new Promise(resolve => setTimeout(resolve, 500)); 
                    
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    // --- DEBUGGING LOGIC START ---
                    if (!response.ok) {
                        const errorBody = await response.text();
                        console.error(`Attempt ${i + 1}: API call failed. Status: ${response.status}. Body:`, errorBody);

                        if (response.status === 429 && i < maxRetries - 1) { 
                            // Throttling detected, retry
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; 
                            continue;
                        }
                        // Non-retryable error (400, 401, 500, etc.)
                        throw new Error(`API call failed with status: ${response.status} - ${response.statusText}. See console for details.`);
                    }
                    // --- DEBUGGING LOGIC END ---


                    updateStatus("Analyzing Trends & Prepping the Content Blueprint...", true);

                    const result = await response.json();
                    
                    // Simulate the final human-like writing phase
                    updateStatus("Production Underway: Writing Human-Like Content...", true);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const textPart = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!textPart) {
                        // Log the full response for deeper inspection
                        console.error("API response was missing content or structured text. Full result:", result);
                        throw new Error("API response was missing content or structured text.");
                    }
                    
                    // The model is instructed to return JSON, so we parse the text part.
                    const parsedResults = JSON.parse(textPart);
                    return parsedResults;

                } catch (error) {
                    // Log the error for the developer (you/me)
                    console.error(`Content Repurposing Error:`, error);
                    if (i === maxRetries - 1) {
                         // Throw the error only on the last failed attempt
                        throw error;
                    }
                    // For non-retryable errors, we exit the loop early to avoid unnecessary delays
                    if (error.message.includes('API call failed with status')) {
                         throw error;
                    }
                    // Wait and retry for network/unknown errors
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
            // Should be unreachable due to explicit throw in the loop, but kept for completeness.
            throw new Error("Failed to fetch content after multiple retries."); 
        }

        function renderResults(results) {
            lastGeneratedResults = results; // Save results for download function
            const container = document.getElementById('results-container');
            container.innerHTML = '';
            
            // Function to create a beautifully styled output card
            const createOutputCard = (platform, content) => {
                const card = document.createElement('div');
                card.className = 'neon-border p-5 rounded-xl shadow-2xl';
                card.innerHTML = `
                    <h3 class="text-xl font-bold mb-3 text-aqua-400 border-b border-aqua-600 pb-2">${platform} Deliverable</h3>
                    <pre class="whitespace-pre-wrap text-sm text-gray-200">${content}</pre>
                    <button class="copy-button neon-button text-xs px-3 py-1 mt-4" data-content="${content.replace(/"/g, '&quot;')}">Copy to Clipboard</button>
                `;
                return card;
            };

            // Loop through the results and create a card for each platform
            for (const key in results) {
                if (results.hasOwnProperty(key)) {
                    // Convert JSON key (e.g., LinkedIn_Post) back to readable name (LinkedIn Post)
                    const platformName = key.replace(/_/g, ' '); 
                    const content = results[key];
                    container.appendChild(createOutputCard(platformName, content));
                }
            }

            // Attach copy functionality
            document.querySelectorAll('.copy-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    // Check if the content attribute exists and is not null
                    const contentToCopy = e.target.getAttribute('data-content');
                    if (contentToCopy) {
                        try {
                            const tempInput = document.createElement('textarea');
                            tempInput.value = contentToCopy;
                            document.body.appendChild(tempInput);
                            tempInput.select();
                            document.execCommand('copy');
                            document.body.removeChild(tempInput);
                            showMessage('Content copied!', false);
                        } catch (err) {
                            showMessage('Could not copy content. Manual copy recommended.', true);
                        }
                    }
                });
            });

            document.getElementById('output-section').classList.remove('hidden');
            document.getElementById('download-button').classList.remove('hidden');
            updateStatus("Meal Served! Your content is ready.", false); // Final cinematic status
        }

        function downloadAllContent() {
            if (!lastGeneratedResults) {
                showMessage("No content generated yet to download.", true);
                return;
            }

            let fileContent = `RizenAi Content Repurposing System - Export\n\nGenerated at: ${new Date().toLocaleString()}\n=========================================\n\n`;

            for (const key in lastGeneratedResults) {
                if (lastGeneratedResults.hasOwnProperty(key)) {
                    const platformName = key.replace(/_/g, ' ');
                    const content = lastGeneratedResults[key];
                    fileContent += `\n--- ${platformName.toUpperCase()} ---\n\n${content}\n\n`;
                }
            }

            const blob = new Blob([fileContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `RizenAi_Content_Export_${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showMessage("Download complete!", false);
        }

        // --- Event Listener ---

        document.addEventListener('DOMContentLoaded', () => {
            initializeAppAndAuth();

            const form = document.getElementById('repurpose-form');
            const outputSection = document.getElementById('output-section');
            const downloadButton = document.getElementById('download-button');

            downloadButton.addEventListener('click', downloadAllContent);

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                outputSection.classList.add('hidden'); // Hide previous results
                downloadButton.classList.add('hidden'); // Hide download button

                const data = getFormData();
                if (!data) return;

                // Initial loading state
                updateStatus("Order Received: Processing request...", true);

                try {
                    const results = await fetchContent(data);
                    renderResults(results);
                } catch (error) {
                    // Log to console for debugging
                    console.error("Final Content Repurposing Error (Caught):", error.message);
                    
                    // Display a user-friendly error message
                    let errorMsg = error.message;
                    if (errorMsg.includes('JSON')) {
                         errorMsg = "API returned an unexpected format. Please try again or check inputs.";
                    } else if (errorMsg.includes('status: 401')) {
                         errorMsg = "Authentication failed. The API key is likely missing or invalid.";
                    } else if (errorMsg.includes('status: 400')) {
                         errorMsg = "Bad Request. API requires valid input fields (Name/Profession/Content).";
                    }
                    
                    showMessage(`System Error: ${errorMsg}`, true);
                    updateStatus("Failed to Generate Content.", false);
                }
            });
        });
    </script>
</body>
</html>
